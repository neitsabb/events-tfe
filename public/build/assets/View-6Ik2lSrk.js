import{r as m,j as e,a as _,q as g,W as S,y as C}from"./app-XS3yalVP.js";import{c as b,B as E}from"./button-QYAymDF9.js";import{E as q,P as V}from"./PaymentForm-DJHrrZkL.js";import{PreferenceComponents as B}from"./PreferencesComponents-BART3yAe.js";import{I as p}from"./Input-DjUkGKqz.js";import"./index-Cqbxwg9X.js";function G({children:a,progress:r}){return m.useEffect(()=>{console.log("Progress:",r)},[r]),e.jsxs("div",{className:b("customer-theme min-h-screen font-integral bg-background"),children:[e.jsxs("header",{className:"p-4 space-y-4",children:[e.jsxs("h1",{className:"font-bold text-2xl",children:["Eventura.",e.jsx(_,{href:route("customer.home"),children:e.jsx(E,{variant:"link",className:"ml-4",children:"Annuler la commande"})})]}),e.jsx(O,{progress:r})]}),e.jsx("main",{className:b("z-50 relative max-w-2xl mx-auto py-16 h-full"),children:a})]})}const O=({progress:a})=>e.jsx("div",{className:"h-1 bg-gray-100 w-full",children:e.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:`${a}%`}})});var L="https://js.stripe.com/v3",T=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,P="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",W=function(){for(var r=document.querySelectorAll('script[src^="'.concat(L,'"]')),t=0;t<r.length;t++){var n=r[t];if(T.test(n.src))return n}return null},k=function(r){var t="",n=document.createElement("script");n.src="".concat(L).concat(t);var s=document.head||document.body;if(!s)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return s.appendChild(n),n},z=function(r,t){!r||!r._registerWrapper||r._registerWrapper({name:"stripe-js",version:"5.4.0",startTime:t})},x=null,j=null,w=null,F=function(r){return function(){r(new Error("Failed to load Stripe.js"))}},M=function(r,t){return function(){window.Stripe?r(window.Stripe):t(new Error("Stripe.js not available"))}},U=function(r){return x!==null?x:(x=new Promise(function(t,n){if(typeof window>"u"||typeof document>"u"){t(null);return}if(window.Stripe&&r&&console.warn(P),window.Stripe){t(window.Stripe);return}try{var s=W();if(s&&r)console.warn(P);else if(!s)s=k(r);else if(s&&w!==null&&j!==null){var c;s.removeEventListener("load",w),s.removeEventListener("error",j),(c=s.parentNode)===null||c===void 0||c.removeChild(s),s=k(r)}w=M(t,n),j=F(n),s.addEventListener("load",w),s.addEventListener("error",j)}catch(u){n(u);return}}),x.catch(function(t){return x=null,Promise.reject(t)}))},X=function(r,t,n){if(r===null)return null;var s=r.apply(void 0,t);return z(s,n),s},v,I=!1,A=function(){return v||(v=U(null).catch(function(r){return v=null,Promise.reject(r)}),v)};Promise.resolve().then(function(){return A()}).catch(function(a){I||console.warn(a)});var K=function(){for(var r=arguments.length,t=new Array(r),n=0;n<r;n++)t[n]=arguments[n];I=!0;var s=Date.now();return A().then(function(c){return X(c,t,s)})};const Y=K("pk_test_51LhFu6AkcKIAKdYfNXkSzc17QelGz8ahfVTL7JRI2rziqgguRnBSq1ft9OrSm4i8ON19GEYo6rAxrrV0IneIjn2v00AIkebPi8"),ne=()=>{const{auth:a,event:r}=g().props,[t,n]=m.useState(0),[s,c]=m.useState("preferences"),u=()=>{c("payment")};return e.jsx(G,{progress:t,children:a!=null&&a.user?s==="preferences"&&r.preferences.length>0?e.jsx($,{onContinue:u,setProgress:n}):e.jsx(Q,{setProgress:n}):e.jsx(J,{setProgress:n})})},$=({onContinue:a,setProgress:r})=>{m.useEffect(()=>{r(25)},[]);const{data:t,setData:n,errors:s,post:c}=S({legal_age:"",email:"",phone:"",birth:""}),{event:u}=g().props,l=(o,d)=>{n(o,d)};m.useEffect(()=>{console.log("Data:",t)},[t]);const h=()=>{console.log("Submitting preferences:",t),c(route("payment.checkout.preferences"),{preserveScroll:!0,onSuccess:a})};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-2xl font-black uppercase tracking-wider leading-none",children:"Informations supplémentaires"}),e.jsx("div",{children:u.preferences.map(o=>{if(o.value==="")return;const d=B[o.key];return d?e.jsx("div",{className:"mt-2",children:e.jsx(d,{value:o.value,onChange:l,errors:s})},o.key):e.jsx("div",{children:e.jsxs("p",{className:"text-red-500",children:["Aucun composant pour la préférence"," ",o.key]})},o.key)})}),e.jsx(E,{onClick:h,variant:"customer_primary",children:"Continuer"})]})},J=({setProgress:a})=>{const{auth:r}=g().props,[t,n]=m.useState(""),[s,c]=m.useState("initial"),u=m.useRef(!1),[l,h]=m.useState({}),{data:o,setData:d}=S({email:t,password:"",confirmEmail:"",confirmPassword:"",firstname:"",lastname:"",birthday:""}),{data:y,setData:N}=S({email:"",password:""}),D=i=>{const f=i;n(f),N("email",f),d("email",f),c("initial"),u.current=!1},R=async()=>{if(!(r!=null&&r.user))if(u.current)if(s==="exists")C.post(route("login.store"),{email:y.email,password:y.password,redirect:route("checkout")},{onError:i=>{h(i)},onSuccess:()=>{}});else{if(o.email!==o.confirmEmail){h({confirmEmail:"Les emails ne correspondent pas."});return}C.post(route("register.store"),{email:o.email,password:o.password,password_confirmation:o.confirmPassword,firstname:o.firstname,lastname:o.lastname,birthday:o.birthday,redirect_to:route("checkout")},{onError:i=>{h(i)},onSuccess:()=>{}})}else{if(!t)return;try{const f=await(await fetch(route("check.email",{email:t}))).json();u.current=!0,c(f?"exists":"notExists"),h({}),a(25)}catch(i){c("initial"),console.error("Error checking email:",i),h({})}}};return e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xl font-black uppercase tracking-wider leading-none",children:"Où est-ce qu'on envoie tes billets ?"}),e.jsx("p",{className:"pb-4 text-sm text-gray-700",children:"Entre ton e-mail pour te connecter ou créer un nouveau compte"})]}),e.jsxs("div",{children:[e.jsx(p,{type:"email",placeholder:"Adresse e-mail",value:t,onChange:D}),l.email&&e.jsx("p",{className:"text-red-500 text-sm",children:l.email}),s==="exists"&&e.jsxs(e.Fragment,{children:[e.jsx(p,{type:"password",placeholder:"Mot de passe",value:y.password,onChange:i=>N("password",i)}),l.password&&e.jsx("p",{className:"text-red-500 text-sm",children:l.password})]}),s==="notExists"&&u.current&&e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(p,{type:"email",placeholder:"Confirmation de l'email",value:o.confirmEmail,onChange:i=>d("confirmEmail",i)}),l.confirmEmail&&e.jsx("p",{className:"text-red-500 text-sm",children:l.confirmEmail})]}),e.jsxs("div",{className:"flex space-x-2 gap-2",children:[e.jsxs("div",{className:"space-y-1 w-full",children:[e.jsx(p,{type:"text",placeholder:"Prénom",value:o.firstname,onChange:i=>d("firstname",i)}),l.firstname&&e.jsx("p",{className:"text-red-500 text-sm",children:l.firstname})]}),e.jsxs("div",{className:"space-y-1 w-full",children:[e.jsx(p,{type:"text",placeholder:"Nom",value:o.lastname,onChange:i=>d("lastname",i)}),l.lastname&&e.jsx("p",{className:"text-red-500 text-sm",children:l.lastname})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(p,{type:"password",placeholder:"Mot de passe",value:o.password,onChange:i=>d("password",i)}),l.password&&e.jsx("p",{className:"text-red-500 text-sm",children:l.password})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(p,{type:"password",placeholder:"Confirmation du mot de passe",value:o.confirmPassword,onChange:i=>d("confirmPassword",i)}),l.password&&e.jsx("p",{className:"text-red-500 text-sm",children:l.password_confirmation})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(p,{type:"date",placeholder:"Date de naissance",value:o.birthday??"",onChange:i=>d("birthday",i)}),l.birthday&&e.jsx("p",{className:"text-red-500 text-sm",children:l.birthday})]})]}),e.jsx(E,{className:"w-full mt-4 uppercase ",variant:"customer_primary",onClick:R,children:"Continuer la commande"})]})]})},Q=({setProgress:a})=>{m.useEffect(()=>{a(50)},[]);const{paymentIntent:r,totalAmount:t,tickets:n}=g().props,s=m.useMemo(()=>({clientSecret:r}),[r]);return e.jsx(q,{stripe:Y,options:s,children:e.jsx(V,{totalAmount:t,tickets:n,paymentIntent:r,setProgress:a})})};export{ne as default};
